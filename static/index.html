<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Research Agent - NIT Durgapur</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    * { 
      margin: 0; 
      padding: 0; 
      box-sizing: border-box; 
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', sans-serif;
      background: #0a0a0a;
      min-height: 100vh;
      color: #e5e5e5;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .header {
      text-align: center;
      padding: 60px 20px;
      margin-bottom: 40px;
      background: linear-gradient(180deg, #1a1a1a 0%, #0f0f0f 100%);
      border-radius: 2px;
      border: 1px solid #2a2a2a;
    }

    .header h1 {
      font-size: 2.8em;
      margin-bottom: 16px;
      font-weight: 300;
      letter-spacing: -1px;
      color: #ffffff;
    }

    .header .subtitle {
      font-size: 1.1em;
      color: #999;
      margin-bottom: 24px;
      font-weight: 300;
      letter-spacing: 0.5px;
    }

    .capabilities {
      display: flex;
      justify-content: center;
      gap: 32px;
      margin-top: 32px;
      flex-wrap: wrap;
    }

    .capability {
      color: #666;
      font-size: 0.85em;
      letter-spacing: 1px;
      text-transform: uppercase;
      padding: 8px 0;
      border-bottom: 1px solid #2a2a2a;
    }

    .main-grid {
      display: grid;
      grid-template-columns: 1fr 320px;
      gap: 24px;
      margin-bottom: 24px;
    }

    @media (max-width: 1024px) {
      .main-grid {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #141414;
      border-radius: 2px;
      padding: 32px;
      border: 1px solid #2a2a2a;
    }

    .input-section {
      margin-bottom: 24px;
    }

    .input-group {
      display: flex;
      gap: 12px;
    }

    input[type="text"] {
      flex: 1;
      padding: 16px 20px;
      font-size: 15px;
      border: 1px solid #2a2a2a;
      border-radius: 2px;
      transition: all 0.2s;
      background: #0a0a0a;
      color: #e5e5e5;
      font-family: inherit;
    }

    input[type="text"]::placeholder {
      color: #666;
    }

    input[type="text"]:focus {
      outline: none;
      border-color: #4a4a4a;
      background: #0f0f0f;
    }

    button {
      padding: 16px 28px;
      font-size: 14px;
      font-weight: 400;
      border: none;
      border-radius: 2px;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      font-family: inherit;
    }

    .btn-primary {
      background: #ffffff;
      color: #0a0a0a;
    }

    .btn-primary:hover:not(:disabled) {
      background: #e5e5e5;
    }

    .btn-primary:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: transparent;
      color: #999;
      border: 1px solid #2a2a2a;
    }

    .btn-secondary:hover {
      background: #1a1a1a;
      color: #e5e5e5;
    }

    .response-area {
      margin-top: 24px;
      max-height: 600px;
      overflow-y: auto;
    }

    .response-area::-webkit-scrollbar {
      width: 6px;
    }

    .response-area::-webkit-scrollbar-track {
      background: #0a0a0a;
    }

    .response-area::-webkit-scrollbar-thumb {
      background: #2a2a2a;
      border-radius: 3px;
    }

    .message {
      margin-bottom: 24px;
      padding: 24px;
      border-radius: 2px;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message-user {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      margin-left: 60px;
    }

    .message-ai {
      background: #0f0f0f;
      border: 1px solid #222;
      margin-right: 60px;
    }

    .message-label {
      font-weight: 500;
      margin-bottom: 12px;
      font-size: 0.75em;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: #666;
    }

    .message-content {
      line-height: 1.8;
      white-space: pre-wrap;
      color: #e5e5e5;
      font-size: 0.95em;
    }

    .message-content h1, .message-content h2, .message-content h3 {
      margin: 20px 0 12px 0;
      font-weight: 400;
      color: #ffffff;
    }

    .message-content ul, .message-content ol {
      margin-left: 24px;
      margin-bottom: 12px;
    }

    .message-content code {
      background: #1a1a1a;
      padding: 3px 8px;
      border-radius: 2px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      border: 1px solid #2a2a2a;
    }

    .metadata {
      display: flex;
      gap: 20px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #2a2a2a;
      font-size: 0.75em;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .stats-card {
      background: #141414;
      border-radius: 2px;
      padding: 24px;
      border: 1px solid #2a2a2a;
    }

    .stats-card h3 {
      color: #ffffff;
      margin-bottom: 20px;
      font-size: 0.85em;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 1.5px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid #1a1a1a;
    }

    .stat-item:last-child {
      border-bottom: none;
    }

    .stat-label {
      color: #999;
      font-size: 0.85em;
    }

    .stat-value {
      font-weight: 500;
      color: #e5e5e5;
      font-variant-numeric: tabular-nums;
    }

    .feature-list {
      list-style: none;
    }

    .feature-list li {
      padding: 10px 0;
      color: #999;
      font-size: 0.85em;
      border-bottom: 1px solid #1a1a1a;
    }

    .feature-list li:last-child {
      border-bottom: none;
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .spinner {
      border: 2px solid #1a1a1a;
      border-top: 2px solid #666;
      border-radius: 50%;
      width: 32px;
      height: 32px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-message {
      background: #1a1a1a;
      border-left: 2px solid #666;
      padding: 16px 20px;
      border-radius: 2px;
      color: #e5e5e5;
      margin-bottom: 24px;
      font-size: 0.9em;
    }

    .suggestions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 20px;
    }

    .suggestion-label {
      width: 100%;
      font-size: 0.75em;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: #666;
      margin-bottom: 4px;
    }

    .suggestion-chip {
      background: #1a1a1a;
      color: #999;
      padding: 10px 16px;
      border-radius: 2px;
      font-size: 0.85em;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid #2a2a2a;
    }

    .suggestion-chip:hover {
      background: #ffffff;
      color: #0a0a0a;
      border-color: #ffffff;
    }

    .export-buttons {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }

    .export-btn {
      flex: 1;
      padding: 12px;
      font-size: 0.75em;
    }

    .about-text {
      font-size: 0.85em;
      color: #999;
      line-height: 1.7;
    }

    .welcome {
      text-align: center;
      padding: 80px 40px;
      color: #666;
    }

    .welcome h3 {
      font-size: 1.2em;
      font-weight: 300;
      margin-bottom: 12px;
      color: #999;
    }

    .welcome p {
      font-size: 0.95em;
      line-height: 1.8;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const SUGGESTIONS = [
      "Latest advances in quantum computing",
      "Compare LangChain vs AutoGen frameworks",
      "Multi-agent AI system best practices",
      "Recent transformer architecture developments",
      "Enterprise RAG implementation patterns"
    ];

    function App() {
      const [query, setQuery] = useState('');
      const [messages, setMessages] = useState([]);
      const [loading, setLoading] = useState(false);
      const [metrics, setMetrics] = useState(null);
      const [error, setError] = useState(null);
      const responseRef = useRef(null);

      useEffect(() => {
        fetchMetrics();
      }, []);

      useEffect(() => {
        if (responseRef.current) {
          responseRef.current.scrollTop = responseRef.current.scrollHeight;
        }
      }, [messages]);

      const fetchMetrics = async () => {
        try {
          const res = await fetch('/api/metrics');
          const data = await res.json();
          if (data.status === 'success') {
            setMetrics(data.metrics);
          }
        } catch (err) {
          console.error('Failed to fetch metrics:', err);
        }
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        if (!query.trim() || loading) return;

        const userQuery = query.trim();
        setQuery('');
        setError(null);
        setLoading(true);

        setMessages(prev => [...prev, {
          role: 'user',
          content: userQuery,
          timestamp: new Date().toISOString()
        }]);

        try {
          const res = await fetch('/api/ask', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ query: userQuery })
          });

          const data = await res.json();

          if (data.status === 'success') {
            setMessages(prev => [...prev, {
              role: 'assistant',
              content: data.answer,
              metadata: data.metadata,
              timestamp: data.timestamp
            }]);
            fetchMetrics();
          } else {
            setError(data.detail || 'An error occurred');
          }
        } catch (err) {
          setError('Failed to connect to server: ' + err.message);
        } finally {
          setLoading(false);
        }
      };

      const handleSuggestion = (suggestion) => {
        setQuery(suggestion);
      };

      const clearHistory = async () => {
        if (!confirm('Clear all conversation history?')) return;
        
        try {
          await fetch('/api/history/clear', { method: 'POST' });
          setMessages([]);
          fetchMetrics();
        } catch (err) {
          setError('Failed to clear history');
        }
      };

      const exportHistory = async (format) => {
        try {
          const res = await fetch(`/api/export/${format}`);
          const blob = await res.blob();
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `research-history.${format}`;
          a.click();
        } catch (err) {
          setError('Failed to export history');
        }
      };

      const renderMarkdown = (text) => {
        return { __html: marked.parse(text) };
      };

      return (
        <div className="container">
          <header className="header">
            <h1>AI Research Agent</h1>
            <div className="subtitle">
              Advanced Multi-Agent Research System
            </div>
            <div className="capabilities">
              <div className="capability">Web Search</div>
              <div className="capability">Wikipedia Access</div>
              <div className="capability">Mathematical Computation</div>
              <div className="capability">Content Summarization</div>
              <div className="capability">Comparative Analysis</div>
            </div>
          </header>

          <div className="main-grid">
            <div className="card">
              <form onSubmit={handleSubmit} className="input-section">
                <div className="input-group">
                  <input
                    type="text"
                    placeholder="Enter your research query..."
                    value={query}
                    onChange={(e) => setQuery(e.target.value)}
                    disabled={loading}
                  />
                  <button 
                    type="submit" 
                    className="btn-primary"
                    disabled={loading || !query.trim()}
                  >
                    {loading ? 'Processing' : 'Research'}
                  </button>
                </div>

                {messages.length === 0 && (
                  <div className="suggestions">
                    <div className="suggestion-label">Suggested Queries</div>
                    {SUGGESTIONS.map((s, i) => (
                      <div 
                        key={i} 
                        className="suggestion-chip"
                        onClick={() => handleSuggestion(s)}
                      >
                        {s}
                      </div>
                    ))}
                  </div>
                )}
              </form>

              {error && (
                <div className="error-message">
                  {error}
                </div>
              )}

              <div className="response-area" ref={responseRef}>
                {messages.length === 0 && !loading && (
                  <div className="welcome">
                    <h3>Welcome to AI Research Agent</h3>
                    <p>Submit any research query to receive comprehensive analysis with citations and sources.</p>
                  </div>
                )}

                {messages.map((msg, idx) => (
                  <div 
                    key={idx} 
                    className={`message ${msg.role === 'user' ? 'message-user' : 'message-ai'}`}
                  >
                    <div className="message-label">
                      {msg.role === 'user' ? 'Query' : 'Response'}
                    </div>
                    <div 
                      className="message-content"
                      dangerouslySetInnerHTML={renderMarkdown(msg.content)}
                    />
                    {msg.metadata && (
                      <div className="metadata">
                        <span>{msg.metadata.time}</span>
                        <span>{msg.metadata.tokens} tokens</span>
                        <span>{msg.metadata.cost}</span>
                      </div>
                    )}
                  </div>
                ))}

                {loading && (
                  <div className="loading">
                    <div className="spinner"></div>
                    <p>Processing request...</p>
                  </div>
                )}
              </div>

              {messages.length > 0 && (
                <div className="export-buttons">
                  <button onClick={() => exportHistory('json')} className="btn-secondary export-btn">
                    Export JSON
                  </button>
                  <button onClick={() => exportHistory('md')} className="btn-secondary export-btn">
                    Export Markdown
                  </button>
                  <button onClick={clearHistory} className="btn-secondary export-btn">
                    Clear History
                  </button>
                </div>
              )}
            </div>

            <div className="sidebar">
              <div className="stats-card">
                <h3>System Metrics</h3>
                {metrics ? (
                  <>
                    <div className="stat-item">
                      <span className="stat-label">Total Queries</span>
                      <span className="stat-value">{metrics.total_queries}</span>
                    </div>
                    <div className="stat-item">
                      <span className="stat-label">Tokens Used</span>
                      <span className="stat-value">{metrics.total_tokens?.toLocaleString()}</span>
                    </div>
                    <div className="stat-item">
                      <span className="stat-label">Total Cost</span>
                      <span className="stat-value">{metrics.total_cost}</span>
                    </div>
                    <div className="stat-item">
                      <span className="stat-label">Avg Response Time</span>
                      <span className="stat-value">{metrics.avg_response_time}</span>
                    </div>
                    <div className="stat-item">
                      <span className="stat-label">Memory Size</span>
                      <span className="stat-value">{metrics.memory_size} messages</span>
                    </div>
                  </>
                ) : (
                  <div className="loading">Loading...</div>
                )}
              </div>

              <div className="stats-card">
                <h3>Capabilities</h3>
                <ul className="feature-list">
                  <li>Real-time web search integration</li>
                  <li>Wikipedia knowledge base access</li>
                  <li>Advanced mathematical computations</li>
                  <li>Intelligent content summarization</li>
                  <li>Multi-source comparative analysis</li>
                  <li>Automatic citation generation</li>
                  <li>Persistent conversation memory</li>
                </ul>
              </div>

              <div className="stats-card">
                <h3>Technology Stack</h3>
                <p className="about-text">
                  Multi-agent architecture powered by LangChain framework with specialized agents for research, 
                  analysis, and synthesis. Built with FastAPI backend and React frontend for seamless real-time interaction.
                </p>
              </div>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
